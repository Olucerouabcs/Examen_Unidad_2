<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossy road</title>
    <style>
        canvas{
            background-color:white;
        }
        body{
            background-color:gray;
        }
    </style>
</head>
<body>
    <center>
        <canvas id="myCanvas" width="700" height="750" style="border:2px solid #000000;"></canvas>
    </center>
    <span id="cronometro" hidden >00:00</span>
    <script>
        var canvas = document.getElementById('myCanvas'); 
        var ctx = canvas.getContext("2d");

        var mainX=0, mainY=0, vida=6;
        var pause=false;
        var dir, paso=30,trayecto=50, cantidadDe=8;
        var invulnerable = false;
        var invulnerabilityDuration = 1000; // 2 segundos en milisegundos
        var lastCollisionTime = 0;
        var gameOverScreen = false;
        var minutos = 0;
        var segundos = 0;
        var nivel=1;
        console.log(canvas.width);
        let imgPlayer = new Image();
        let img = new Image();
        let img2 = new Image();
        let img3 = new Image();
        let img4 = new Image();
        let img5 = new Image();
        let img6 = new Image();
        let img7 = new Image();
        let img8 = new Image();
        let img9 = new Image();
        let audio = new Audio();
        let audio2 = new Audio();
        let audio3 = new Audio();
        let audio4 = new Audio();
        let audio5 = new Audio();
        let audio6 = new Audio();
        audio.src = 'Blippy_Trance.mp3';
        audio.loop = true
        audio.volume = 0.4;
        audio2.src = 'gallina.mp3';
        audio3.src = 'choque.mp3';
        audio4.src = 'street-traffic-2.mp3';
        audio4.loop = true
        audio4.volume = 0.4;
        audio5.src = 'Evening.mp3';
        audio5.loop = true
        audio6.src = 'paso.mp3';
        audio6.volume = 1;
        //audio.play();
        img.src = 'cesped.png';
        img2.src = 'carreteraH.png';
        img3.src = 'carroRojo-2.png';
        img4.src = 'carroVerde.png';
        img5.src = 'estacionamiento.jpg';
        img6.src = 'polleria.png';
        img7.src = 'fondo.jpg';
        img8.src = 'jefe.png'
        img9.src = 'cuchillo.png';
        imgPlayer.src = 'Player.png';
        //ctx.drawImage(img2, x2, y2, 100, 100); 

        var enBalsa = false;
        
        var si =true;

        function tablero(){
           
            audio.play();
            audio4.play();
            ctx.fillStyle = "cyan";
            ctx.fillRect(0, 0, 85, canvas.height);

            ctx.fillStyle = "rgb(255,105,97)";
            ctx.fillRect(canvas.width-85, 0, 85, canvas.height);

            ctx.font = "20px Arial";
            ctx.fillStyle = "black"; 
            ctx.fillText("Tiempo" , 10, 40)
            //Poner que funcione el tiempo
            ctx.fillText(getTiempoFormateado(), 10, 70); // Llama a una función para obtener el tiempo formateado
            ctx.fillText("Nivel" , 10, 130)
            //Poner que funcione el contador de nivel
            ctx.fillText(nivel , 60, 130)
        
            //Contador de vidas
            ctx.fillText("Vidas" , 10, 210);
            ctx.fillText(vida , 70, 210);
        }

        tablero();

        document.addEventListener("keydown", (e) => {
            console.log(e);
            
            switch (e.keyCode) {
        case 87:
            if (!pause) { 
                audio6.play();
                dir = 1;
                if(trayecto>=32930){
                    moveObjetos(0,0);
                }else{
                    moveObjetos(0,paso);
                    console.log("Arriba");
                }
            }
            break;
        case 83:
            if (!pause) { 
                audio6.play();
                dir = 2;
                if(trayecto<70){
                    moveObjetos(0,0);
                }else{
                    moveObjetos(0,-paso);
                    console.log("Abajo");
                }

            }
            break;
        case 68:
            if (!pause) { 
                audio6.play();
                dir = 3;
                if(jugador.x>550){
                    movePlayer(0,0);    
                }else{
                    movePlayer(paso,0);
                }

            }
            break;
        case 65:
            if (!pause) { 
                audio6.play();
                dir = 4;
                if(jugador.x<90){
                    movePlayer(0,0);    
                }else{
                    movePlayer(-paso,0);
                }
                console.log("x: "+jugador.x );
                console.log("izquierda");
            }
            break;
        case 32:
            pause = !pause;
            break;
        }

        });



        function repaint() {
            if(!pause){
                
                //ctx.fillStyle = "white";
                //ctx.fillRect(0, 0, 700, 900);

               if(coches[0].x==630  || coches[2].x==630){//|| si ==false
                coches[0].x =10;
                coches[2].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[1].x==10 ){//|| si ==false
                coches[1].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[3].x==10 ){//|| si ==false
                coches[3].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[4].x==630){//|| si ==false
                coches[4].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[5].x==10 ){//|| si ==false
                coches[5].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[6].x==630){//|| si ==false
                coches[6].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[7].x==10 ){//|| si ==false
                coches[7].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[8].x==630){//|| si ==false
                coches[8].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[9].x==10 ){//|| si ==false
                coches[9].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[10].x==630){//|| si ==false
                coches[10].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[11].x==10 ){//|| si ==false
                coches[11].x =630;
                  //si=false;
                  console.log(si);
               }
               if(coches[12].x==630){//|| si ==false
                coches[12].x =10;
                  //si=false;
                  console.log(si);
               }
               if(coches[13].x==10 ){//|| si ==false
                coches[13].x =630;
                  //si=false;
                  console.log(si);
               }
               //if(coche.x==85||si==true){
                coches[0].x +=1; 
                coches[1].x -=1;
                coches[2].x +=1;
                coches[3].x -=1;
                coches[4].x +=1;
                coches[5].x -=1;
                coches[6].x +=1; 
                coches[7].x -=1;
                coches[8].x +=1;
                coches[9].x -=1;
                coches[10].x +=1;
                coches[11].x -=1;
                coches[12].x +=1;
                coches[13].x -=1;
               // si=true;
               // console.log(si);
               //}

               repintarObjetos();
               
                if (invulnerable) {
                    // Cambia el estado de visibilidad del jugador cada 200 ms para el efecto de parpadeo.
                    if (Date.now() - lastCollisionTime > 100) {
                        jugador.dibujar();
                    }
                    
                } else {
                    jugador.dibujar();
                }
               tablero()
               
            }else{
                //ctx.fillStyle = "rgba(154,160,154,0.00000002)";
                //ctx.fillRect(85, 0, 700, 900);

                ctx.font = "40px Arial";
                ctx.fillStyle = "black"; 
                ctx.fillText("p "+"a "+"u "+"s "+"a", 700/ 2 - 95, 700/ 2);
                tablero() 
            }
        }

        function update() {
            if(pause==false){
                console.log("dir " + dir);
                checkCollisions();

                switch (dir) {
                    case 1:
                        //cesped.y += paso;
                        break;
                    case 2:
                        //cesped.y -= paso;
                        break;
                    case 3:
                        //jugador.x += paso;

                        break;
                    case 4:
                        //jugador.x -= paso;

                        break;
                }
            }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (gameOverScreen) {
                displayGameOverScreen();
            } else {
                repaint();
            }
            window.requestAnimationFrame(update);
        }

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        window.requestAnimationFrame(update);
        

        class Jugador {
            constructor() {
                this.x = (canvas.width/2)-35; // Coordenada X inicial
                this.y = 600; // Coordenada Y inicial
                this.width = 70; // Ancho del cuadro
                this.height = 70; // Alto del cuadro
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                //ctx.fillStyle = 'black'; // Color del cuadro (en este caso, azul)
                //ctx.fillRect(this.x, this.y, this.width, this.height); // Dibujar el cuadro
                ctx.drawImage(imgPlayer,this.x, this.y, this.width, this.height);
            }
        }

        // Crear una instancia de Jugador
        const jugador = new Jugador();

        // Dibujar el jugador en el lienzo
        //jugador.dibujar();

        class Rio{
            constructor(dy) {
                this.x = 85; // Coordenada X inicial
                this.y = dy; // Coordenada Y inicial
                this.width = 530; // Ancho del cuadro
                this.height = 300; // Alto del cuadro
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                ctx.fillStyle = 'blue'; // Color del cuadro (en este caso, azul)
                ctx.fillRect(this.x, this.y, this.width, this.height); // Dibujar el cuadro
            }

        }

        // Crear una instancia de Jugador
        const rio1 = new Rio(200);
        const rio2 = new Rio(-500);

        // Dibujar el Rio en el lienzo
        rio1.dibujar();
        rio2.dibujar();

        class Carretera{
            constructor(dy) {
                this.x = 85; // Coordenada X inicial
                this.y = dy; // Coordenada Y inicial
                this.width = 530; // Ancho del cuadro
                this.height = 1200; // Alto del cuadro
                
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                //ctx.fillStyle = 'grey'; // Color del cuadro (en este caso, azul)
                //ctx.fillRect(this.x, this.y, this.width, this.height); // Dibujar el cuadro
                ctx.drawImage(img2,this.x, this.y, this.width, this.height);
            }

        }

        // Crear una instancia de cesped
        var posicionCarreteraX = [-250,-750,-1200,-1600,-2000,-2400,-2800,-3300]

        var carreteras = [];
        for (var i=0;i<cantidadDe;i++){
            carreteras.push(new Carretera(posicionCarreteraX[i]));
        }

        // Dibujar el carretera en el lienzo
        //carretera.dibujar();

        class Cesped{
            constructor(dy) {
                this.x = 85; // Coordenada X inicial
                this.y = dy; // Coordenada Y inicial
                this.width = 530; // Ancho del cuadro
                this.height = 700; // Alto del cuadro
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                //ctx.fillStyle = 'green'; // Color del cuadro (en este caso, azul)
                ctx.drawImage(img,this.x, this.y, this.width, this.height); // Dibujar el cuadro
            }

        }

        // Crear una instancia de cesped
        var posicionCespedX = [50,-500,-1000,-1400,-1800,-2200,-2600,-3000]

        var cespedes = [];
        for (var i=0;i<cantidadDe;i++){
            cespedes.push(new Cesped(posicionCespedX[i]));
        }
        //const cesped = new Cesped(50);
        //const cesped2 = new Cesped(-500);
        //const cesped3 = new Cesped(-1400);
        //const cesped4 = new Cesped(-1000);


        // Dibujar el cesped en el lienzo
        //cesped.dibujar();
        
        class Coche{
            constructor(dy,dx,img) {
                this.x = dx; // Coordenada X inicial
                this.y = dy; // Coordenada Y inicial
                this.width = 120; // Ancho del cuadro
                this.height = 85; // Alto del cuadro
                this.img = img;
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                //ctx.fillStyle = 'yellow'; // Color del cuadro (en este caso, azul)
                //ctx.fillRect(this.x, this.y, this.width, this.height); // Dibujar el cuadro
                ctx.drawImage(this.img,this.x, this.y, this.width, this.height);
            }

        }

        var posicionCochesX = [380,210,-120,-290,-570,-740,-970,-1140,-1370,-1540,-1770,-1940,-2170,-2340]

        var coches = [];
        var dentro = true;
        for (var i=0;i<cantidadDe*2;i++){
            
            if (dentro == true){
                coches.push(new Coche(posicionCochesX[i],100,img3));
                dentro=false;
            }else{
                coches.push(new Coche(posicionCochesX[i],100,img4));
                dentro=true;
            }
            

        }
        class Estacionamiento{
            constructor(dy) {
                this.x = 85; // Coordenada X inicial
                this.y = dy; // Coordenada Y inicialww
                this.width = 530; // Ancho del cuadro
                this.height = 800; // Alto del cuadro
            }

            dibujar() {
                //ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el lienzo
                //ctx.fillStyle = 'yellow'; // Color del cuadro (en este caso, azul)
                //ctx.fillRect(this.x, this.y, this.width, this.height); // Dibujar el cuadro
                ctx.drawImage(img5,85,this.y,this.width,this.height );
                ctx.drawImage(img7,85,this.y-750,this.width,this.height );
                ctx.drawImage(img6,85,this.y-630,this.width,this.height );
                
            }
           
        }
        const estacionamiento = new Estacionamiento(-3500);

        
        

        //coches.push(new Coche(posicionCochesX[0],100,img3));
        //coches.push(new Coche(posicionCochesX[1],630,img4));


        //const coche = new Coche(400,100,img3);
        //const coche2 = new Coche(230,630,img4);

        //coche.dibujar();

        function repintarObjetos(){
            //rio1.dibujar();
            //rio2.dibujar();
           
            for (var i=0;i<cantidadDe;i++){
            cespedes[i].dibujar();
            }
            estacionamiento.dibujar();
            for (var i=0;i<cantidadDe;i++){
                carreteras[i].dibujar();
            }
            
            //carretera.dibujar(); 
            //carretera2.dibujar(); 
            //carretera3.dibujar(); 
            //carretera4.dibujar(); 
            for (var i=0;i<cantidadDe*2;i++){
                coches[i].dibujar();
            }
            //coches[0].dibujar();
            //coches[1].dibujar();
        }


        function movePlayer(dx, dy) {
            if (!pause) {
                if (enBalsa) {
                    jugador.x += 1; // Mover al jugador horizontalmente con la balsa
                } else {
                    jugador.x += dx;
                    jugador.y += dy;
                }
                repaint();
            }
        }

        function moveObjetos(dx, dy) {
         // Mueve al jugador en la dirección especificada (dx, dy)

         for (var i=0;i<cantidadDe;i++){
            cespedes[i].y += dy;
            trayecto += dy;
         }

         rio1.y += dy;
         rio2.y += dy;
         estacionamiento.y += dy;

         for (var i=0;i<cantidadDe;i++){
            carreteras[i].y += dy;
         }

         //carretera.y += dy;
         //carretera2.y+= dy;
         //carretera3.y+= dy;
         //carretera4.y+= dy;

         for (var i=0;i<cantidadDe*2;i++){
            coches[i].y += dy;
         }

         //coches[0].y += dy;
         //coches[1].y += dy;
         
         repaint();
        }
        function checkCollisions() {
            if (!invulnerable) {
                for (var i = 0; i < coches.length; i++) {
                    var coche = coches[i];
                    if (
                        jugador.x < coche.x + coche.width &&
                        jugador.x + jugador.width > coche.x &&
                        jugador.y < coche.y + coche.height &&
                        jugador.y + jugador.height > coche.y
                    ) {
                        // Colisión detectada mientras no esté invulnerable
                        handleCollision();
                    }
                }
            }
        }

        function handleCollision() {
            if (!invulnerable) {
                vida--; // Reducir la cantidad de vidas
                invulnerable = true; // El jugador ahora es invulnerable
                lastCollisionTime = Date.now(); // Registra el tiempo de la última colisión

                // Reubicar al jugador en una posición segura después de la colisión.
                jugador.x = (canvas.width / 2) - 25;
                jugador.y = 600;
                audio2.play();
                audio3.play();
                if (vida <= 0) {
                    pause = true;
                    gameOverScreen = true; // Establece el estado de "Game Over" cuando se agoten las vidas
                }

                // Inicia un temporizador para volver al jugador vulnerable después de 2 segundos.
                setTimeout(() => {
                    invulnerable = false;
                }, invulnerabilityDuration);
            }
        }
        function displayGameOverScreen() {
            audio.pause();
            audio5.play();
            ctx.fillStyle = "rgba(0, 0, 0, 0.7)"; // Fondo oscuro
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.font = "40px Arial";
            ctx.fillStyle = "white";
            ctx.fillText("Game Over", canvas.width / 2 - 100, canvas.height / 2 - 40);

            // Dibuja el botón de "Volver a Empezar"
            ctx.fillStyle = "red";
            ctx.fillRect(canvas.width / 2 - 160, canvas.height / 2 + 20, 320, 40);
            ctx.fillStyle = "white";
            ctx.fillText("Volver a Empezar", canvas.width / 2 - 160, canvas.height / 2 + 50);

            // Agrega un detector de clic para el botón de "Volver a Empezar"
            canvas.addEventListener("click", restartGame);
        }

        function restartGame(event) {
            // Verifica si se hizo clic en el botón de "Volver a Empezar"
            var rect = canvas.getBoundingClientRect();
            var mouseX = event.clientX - rect.left;
            var mouseY = event.clientY - rect.top;

            if (
                mouseX > canvas.width / 2 - 80 &&
                mouseX < canvas.width / 2 + 80 &&
                mouseY > canvas.height / 2 + 20 &&
                mouseY < canvas.height / 2 + 60
            ) {
                // Reinicia el juego
                gameOverScreen = false;
                vida = 3; // Restablece las vidas u otros valores del juego según sea necesario.
                pause=false;
                location.reload();
                // Otras reinicializaciones del juego...

                // Elimina el detector de clic para evitar múltiples clics accidentales
                canvas.removeEventListener("click", restartGame);
            }
        }
        function getTiempoFormateado() {
    var minutosStr = minutos < 10 ? "0" + minutos : minutos.toString();
    var segundosStr = segundos < 10 ? "0" + segundos : segundos.toString();
    return minutosStr + ":" + segundosStr;
}

// Actualiza el cronómetro cada segundo
setInterval(function () {
    segundos++;
    if (segundos === 60) {
        minutos++;
        segundos = 0;
    }
    repaint(); // Vuelve a dibujar para mostrar el tiempo actualizado
}, 1000);



    </script>
    
</body>
</html>